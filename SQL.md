# SQL

## **SELECT**

---

* 사용자가 입력한 데이터를 조회한다.

* SELECT [**ALL**/**DISTINCT**] 출력 대상 컬럼명, 출력대상 컬럼명...
  FROM 출력 대상 컬럼들이 있는 테이블
  **ALL** : Default 옵션으로 별도로 표시하지 않는다, 중복값 모두 출력(생략 가능)
  **DISTINCT** : 중복 데이터를 1건으로 처리해 출력한다.

  * **ALIAS**
    * 조회된 결과에 일종의 별명 부여후 컬럼 레이블 변경
    * ALIAS는 컬럼명 바로 뒤에 온다.
    * 칼럼과 ALIAS 사이에는 **as** 키워드 사용(안써도 됨)
    * ALIAS사이에 **공백**이 들어가면 **""**로 묶는다.  Ex) "선수 명"

  * **산술 연산자와 합성 연산자**
    * **산술연산자**

      * NUMBER와 DATE 자료형에 대해 적용된다.
      * `(), *, /, +, -` 의 우선 순의를 가진다.

    * **합성연산자**

      * 문자와 문자를 연결한다.

      * 별도의 프로그램 도움 없이 SQL문장으로 리포트를 출력한다.

      * 문자와 문자를 연결하는 경우 2개의 수직 바(||)에 의해 연결되어진다.

        player_name || '선수', ...

      * 위 내용을 concat(string1, string2) 함수를 써서 표현 똑같이 표현할 수 있다.

        concat(player_name, '선수'), ...

  * **함수**
    * **내장함수**

      * 데이터베이스를 설치하면 기본적으로 제공받는 함수
      * 단일행 함수

        * 문자형 함수 ,숫자형 함수,  날짜형 함수, 변환 함수, NULL관련 함수가 있다.
        * **`select, where, order by`**절에서 사용 가능하다.
        * 개별적으로 각행의 데이터 값들을 조작하고, 조작결과를 리턴한다.
        * **case**

| CASE 표현                                                    | 설명                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| SIMPLE_CASE_EXPRESSION 조건<br />[ELSE 디폴트값]<br />END    | CASE 다음에 바로 조건에 사용되는 칼럼이나 표현식이 오고, WHEN절에서 앞에서 정의한 칼럼이나 표현식과 같은지 다른지를 판단한다. EQUI(=) 조건을 간단하게 사용할 수 있다. |
| CASE SEARCHED_CASE_EXPRESSION 조건<br />[ELSE 디폴트값]<br />END | CASE 다음에는 칼럼이나 표현식을 표시하지 않고, WHEN 절에서 EQUI(=) 및 여러조건(>, >=, <, <=)을 다양하게 적용할 수 있다. |
| DECODE(표현식, 기준값1, 값1,기준값2, 값2, ........, 디폴트값) | 표현식 값이 기준값1이면 값1 출력, 기준값2이면 값2를 출력, 기준값이 없으면 디폴트 값을 출력한다. |

​	[DECODE 예시](https://gent.tistory.com/227)

> 출처 : 젠트의 프로그래밍 세상

* **문자형 함수**

  * `LOWER('문자열'` : 소문자로 바꿔줌
  * `UPPER('문자열')` : 대문자로 바꿔줌
  * `ASCII('문자'or'숫자')` : 아스키 코드번호로 바꿔줌
  * `CHR/CHAR(ASCII번호)` : ASCII코드번호를 문자나 숫자로 바꿔줌
  * `CONCAT` : 문자열을 연결해줌 
    `CONCAT('RDBMS','SQL')` == `'RDBMS' || 'SQL'`== `'RDBMS' + 'SQL'`
  * `SUBSTR/SUBSTRING('문자열' m, n)` : 문자열의 m번째 부터 n개의 문자 출력. n이 생략되면 마지막 문자까지 출력
  * `LENGTH/LEN('문자열')` : 문자열의 개수를 숫자값으로 돌려준다.
  * `LTRIM('문자열', '지정문자')` : 문자열의 첫 문자 부터 확인해서 지정문자가 나타나면 해당 문자를 제거. (지정문자가 생략되면 공백값이 디폴트, SQL Server에서는 지정문자를 사용할 수 없어 공백만 지울 수 있음.)
  * `RTRIM('문자열', '지정문자')` : 문자열의 마지막 문자부터 확인해서 지정문자가 나타나면 제거한다. (주로 공백제거 및 **CHAR**와 **VARCHAR** 데이터 유형을 비교할때 사용!)
  * `TRIM`('지정문자' FROM '문자열') : 문자열에서 머리말, 꼬리말, 또는 양쪽에 있는 지정 문자를 제거(SQL Server에서는 지정문자를 사용할 수 없어 공백만 지울 수 있음.))

* **숫자형 함수**

  * `ABS(숫자)` : 숫자의 절대값을 돌려준다.
  * `SIGN(숫자)` : 숫자가 양수인지, 음수인지 0인지 구별해준다. 
  * `MOD(숫자1, 숫자2)` : 숫자1을 숫자 2로 나누어 나머지를 리턴한다.(`숫자1 % 숫자2 `로 대체 가능)
  * `CEIL/CEILING(숫자)` : 숫자보다 크거나 같은 최소 정수를 리턴한다.
  * `FLOOR(숫자)` : 숫자보다 작거나 같은 최대 정수를 리턴한다.
  * `ROUND(숫자, m)` : 숫자를 소수점 m자리까지 반올림해서 리턴한다.(m이 생략되면 디폴트값은 0이다.)
    Ex) `ROUND(1.123456789,5)` -> 1.12346 출력
  * `TRUNC(숫자, m)` : 숫자를 소수점 m자리까지 잘라서 버린다.(m이 생략되면 디폴트값은 0이다. SQL SERVER에서는 함수가 제공되지 않는다.)
    Ex) `TRUNC(1.123456789,5)` -> 1.12345 출력
  * `EXP(), POWER(), SQRT(), LOG()....` : 숫자의 지수, 거듭 제곱, 제곱근, 자연 로그....

* **날짜형 함수**

  * `SYSDATE` : 현재 날짜와 시각을 출력한다.

  * `  EXTRACT('YEAR'|'MONTH'|'DAY' from d)/DATEPART('YEAR'|'MONTH'|'DAY', d)` : 날짜 데이터에서 **년/월/일** 데이터를 출력할 수 있다. **시간/분/초** 도 가능함.

  * `TO_NUMBER(TO_CHAR(d,'YYYY'))/YEAR(d)` : `TO_NUMBER` 제외시 문자열로 출력됨.

  * **참고**

    ```sql
    SELECT TO_CHAR(SYSDATE, 'YYYY/MM/DD') 날짜,
         TO_CHAR(SYSDATE, 'YYYY. MON, DAY') 문자형
    FROM DUAL;
    ```

     -> `2021/01/14`와 `2021. 1월, 목요일` 출력

* **변환형 함수**

  * `TO_NUMBER('문자열')` : **alphanumeric** 문자열을 숫자로 변환

  * `TO_CHAR(숫자|날짜, FOMAT)` : 숫자나 날짜를 주어진 **FORMAT** 형태로 문자열 타입으로 변환한다.

    ```sql
    SELECT TO_CHAR(SYSDATE, 'YYYY/MM/DD') 날짜,
              TO_CHAR(SYSDATE, 'YYYY. MON, DAY') 문자형
    FROM DUAL; 
    
    SELECT TO_CHAR(123456789/1200,'$999,999,999.99') 환율반영달러,
              TO_CHAR(123456789,'L999,999,999') 원화
    FROM DUAL; 
    ```

    

* **다중함수**

  * 집계 함수
  * 그룹 함수
  * 윈도우 함수

  

## WHERE

---

* 자료들에 대하여 제한할 수 있다.

* 두개이상의 테이블을 조인하거나 결과를 제한하기 위한 조건을 기술 할 수 있다.

  * 컬럼명*(보통 조건식 좌측에 위치)*
  * 비교연산자
  * 문자,숫자,표현식*(보통 조건식 우축에 위치)*
  * 비교 칼럼명*(JOIN 사용시)*

* **연산자 종류**

  * SQL 연산자

    * `BETWEEN a AND b` : a와 b의 값 사이에 있으면 된다.

    * `IN(list)` : 리스트에 있는 값중에 어느 하나라도 일치하면 된다.

    * `LIKE '비교문자열'` : 비교문자열과 형태가 일치하면 된다 *(%, _ 사용)*

      ​	*Ex) _A%*
    ​	`_` : _의 갯수만큼 글자가 있고 그다음에 A가 나와야함. *(pA~, AA~)*
      ​		  만약 _A였다면 A뒤에 다른 값이 있는 데이터는 찾지 않는다.	
    ​	`%` : 글자가 없거나 하나 이상의 값이 들어가야함. *(aA, qAww123, dA....)*
    
  * `is null` : NULL 값인 경우 <-> `is not null`
    
  * `<>` : 같지 않다.*(ISO 표준, 모든 운영체제에서 사용 가능)*
    
  * `NOT 칼럼명 = A` :  A와 같지 않다.
    
  * `NOT 칼럼명 > A` : A보다 크지 않다.
  
* **연산자 우선순위**

  1. 괄호 ()
  2. 비교 연산자, SQL 연산자
  3. NOT 연산자
  4. AND
  5. OR

## GROUP BY

---

* **집계함수**

  * 여러 행들 그룹이 모여 **그룹당 단 하나의 결과**를 돌려주는 함수
  * **GROUP BY**절은 행들을 **소그룹화** 한다.
  * **SELECT**, **HAVING**, **ORDER BY**절에 사용할 수 있다.

* **집계함수의 종류**

  * `COUNT(*)` : NULL 값을 포함한 행의 수를 출력한다.

  * `COUNT(표현식)` : 표현식의 값이 NULL 값인 것을 제외한 행의 수를 출력한다.

  * `SUM( [ DISTINCT | ALL ] 표현식 )` : 표현식의 NULL 값을 제외한 합계를 출력한다.

  * `AVG( [ DISTINCT | ALL ] 표현식 )` : 표현식의 NULL 값을 제외한 평균을 출력한다.

  * `MAX( [ DISTINCT | ALL ] 표현식 )` : 표현식의 최대값을 출력한다.*(문자, 날짜 데이터 타입도 사용가능)*

  * `MIN( [ DISTINCT | ALL ] 표현식 )` : 표현식의 최소값을 출력한다.

  * `STDDEV( [ DISTINCT | ALL ] 표현식 )` : 표현식의 표준 편차를 출력한다.

  * `VARIAN( [ DISTINCT | ALL ] 표현식 )` : 표현식의 분산을 출력한다.

  * 기타 통계 함수 : 벤더별로 다양한 통계식을 제공한다.

    \* **ALL** : Default 옵션으로 생략 가능

    \* **DISTINCT** : 같은 값을 하나의 데이터로 간주할 때 사용하는

* **GROUP BY  절**

  * **FROM**절과 **WHERE**절 뒤에 온다.

  * 데이터를 작은 그룹으로 분류하여 소그룹에 대한 항목별로 통계정보를 얻을 때 사용한다.

  * **GROUP BY절 형식**

    **`SELECT`** `[DISTINCT] 칼럼명 [ALIAS명]`

    **`FROM`** `테이블명`

    `[`**`WHERE`** `조건식]`

    `[`**`GROUP BY`** **`칼럼(Column)`**`이나 `**`표현식`**`]`

    `[`**`HAVING` **`그룹조건식];`

* **GROUP BY**절과 **HAVING**절의 특성

  * **GROUP BY**절은 ~~ALIAS~~를 사용할 수 없다
  * 집계함수는 **WHERE**절에 올 수 없다 *(집계 함수를 사용할 수 있는 **GROUP BY**절 보다 **WHERE**절이 먼저 수행됨.)*
  * **HAVING**절은 **GROUP BY**절의 기준 항목이나 소그룹 집계 함수 조건을 표시
  * **GROUP BY**절의 소그룹별로 만들어진 집계 데이터 중, **HAVING**절에서 제한 조건을 두어 조건을 만족하는 내용만 출력한다.
  * **HAVING** 절은 일반적으로 **GROUP BY** 절 뒤에 위치한다.
  * **WHERE**절에서 조건적을 적용하여 **GROUP BY**의 계산 대상을 줄이는 것이 효율적인 자원 사용 측면에서 바람직하다.

## ORDER BY절, SELECT문의 실행 순서

* 특정 칼럼을 기준으로 정렬하여 출력하는데 사용한다.

* 칼럼명 대신 SELECT 문에서 사용한 ALIAS명이나 칼럼 순서를 나타내는 정수도 사용 가능하다.

  ​	`SELECT PLAYER_NAME 선수명, TEAM_ID 팀아이디, PLAYER_ID 선수_아이디.....`

  ​	`ORDER BY 1, 3 DESC, 팀아이디`*( 1 = 선수명, 3= 선수_아이디(내림차순) )*

* ORDER BY의 두가지 정렬 방식

  * ASC(Ascending) : 오름차순으로 정렬*(DEFAULT)*

  * DESC(Descending) : 내림차순으로 정렬

    \* Oracle 에서는 NULL을 가장 큰값으로 간주 오름차순의 경우 제일 아래에 NULL값이 위치함

* **SELECT 문의 실행순서**

  ​	5 `SELECT 칼럼명 [ALIAS명]`

  ​	1 `FROM 테이블명`

  ​	2 `WHERE 조건식`

  ​	3 `GROUP BY 칼럼(Column)이나 표현식`

  ​	4 `HAVING 그룹조건식`

  ​	6 `ORDER BY 칼럼(Column)이나 표현식;`	
