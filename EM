<mxfile host="app.diagrams.net" modified="2022-10-31T06:16:02.718Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36" etag="jRcfNqi3UTWnTuY_KA-4" version="20.5.1" type="github">
  <diagram id="HJia9yeKJAP1iVvcOQoG" name="페이지-1">
    <mxGraphModel dx="1278" dy="568" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="1600" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="XbTbOmQ3Rbi7m6c_Uwy1-2" value="&lt;h1&gt;EM(Export Manager)&lt;/h1&gt;&lt;p&gt;API 서버에서 Export 요청을 받아 녹화 파일을 .avi 형태로 NAS에 저장.&lt;/p&gt;&lt;p&gt;완료시 DB Update(어떻게) 시행.&lt;/p&gt;&lt;p&gt;EM 초기 기동시 Export 하지 못한 작업을 수행 하도록 함(어디서 어떻게)&lt;/p&gt;&lt;p&gt;왜 Export 하지 못했지?&lt;br&gt;&amp;nbsp;- 비정상 종료or 업데이트등으로 인한 프로세스 중단&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="40" y="40" width="320" height="200" as="geometry" />
        </mxCell>
        <mxCell id="XbTbOmQ3Rbi7m6c_Uwy1-3" value="&lt;b&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;실행 순서&lt;br&gt;&lt;/font&gt;&lt;/b&gt;API 요청 &lt;br&gt;-&amp;gt; 요청 검사 &lt;br&gt;-&amp;gt; 메시지 정상 여부 응답 &lt;br&gt;-&amp;gt; Export 목록 DB에 insert&amp;nbsp;&lt;br&gt;-&amp;gt; NAS에 avi 파일 생성 &lt;br&gt;-&amp;gt; 완료 정보 DB update" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="40" y="280" width="320" height="120" as="geometry" />
        </mxCell>
        <mxCell id="JeBBuEgRUef21G0-mVo3-3" value="&lt;h1&gt;&lt;b&gt;std::enable_shared_from_this&amp;lt;A&amp;gt;&lt;/b&gt;&lt;br&gt;&lt;/h1&gt;&lt;p&gt;A객체의 생성 및 소멸에 의한 참조 문제를 방지하기 위해 사용.&lt;br&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;EX)&lt;/b&gt;&lt;br&gt;class A : public std::enable_shared_from_this&amp;lt;A&amp;gt;&lt;br&gt;{&lt;br&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;...&lt;br&gt;}&lt;br&gt;int main()&lt;br&gt;{&lt;br&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;std::shared_ptr&amp;lt;A&amp;gt; ptr1, ptr2;&lt;br&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;prt1 = new A;&lt;br&gt;&lt;span style=&quot;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;ptr2 = ptr1-&amp;gt;shared_from_this();&lt;br&gt;}&lt;br&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="400" y="40" width="440" height="280" as="geometry" />
        </mxCell>
        <mxCell id="JeBBuEgRUef21G0-mVo3-4" value="&lt;h1&gt;createNew(emIni)&lt;/h1&gt;&lt;p&gt;ServicdAppParameter 초기화&lt;/p&gt;&lt;p&gt;DBParameter 초기화&lt;/p&gt;&lt;p&gt;ExportParameter 초기화&lt;/p&gt;&lt;p&gt;ThumbnailParameter 초기화&lt;/p&gt;&lt;p&gt;new EmApp&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="880" y="40" width="240" height="200" as="geometry" />
        </mxCell>
        <mxCell id="JeBBuEgRUef21G0-mVo3-6" value="&lt;h1&gt;logic?&lt;/h1&gt;&lt;p&gt;EmApp::load&lt;br&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;DB에서 select 해온 값이 있다면?&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;이후 메시지 유효성 판단&lt;/span&gt;&lt;/p&gt;&lt;p&gt;EmApp::runExport&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;addExport에서 export 진행?&lt;br&gt;&lt;/p&gt;&lt;p&gt;EmApp::onCompleteExport&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;ExportJob에서 report값 받아옴&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;이 값으로 Update 진행&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="880" y="280" width="240" height="180" as="geometry" />
        </mxCell>
        <mxCell id="JeBBuEgRUef21G0-mVo3-7" value="&lt;h1&gt;bind&lt;/h1&gt;&lt;p&gt;함수의 일부 매개 변수를 고정 값으로 세팅한 후, 한번 Wrapping하여 사용할 수 있게 해주는 함수&lt;/p&gt;&lt;p&gt;1. function class를 사용&lt;br&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;std::function&amp;lt;wrapping 함수 형태&amp;gt; 변수명 = bind(함수명, 인자1, 인자 2, ...);&lt;br&gt;함수명을 변수명에 연결&lt;/span&gt;&lt;/p&gt;&lt;p&gt;2. auto 키워드 사용&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;auto 변수명 = bind(함수명, 인자1, 인자2, ...);&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;함수명을 변수명에 연결&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Ex)&lt;/b&gt;&lt;/p&gt;&lt;p&gt;using namespace std::placeholders;&lt;br&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;using namespace std;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;class Object {&lt;br&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;public:&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; white-space: pre;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;void hello(const string&amp;amp; s) { cout &amp;lt;&amp;lt; s &amp;lt;&amp;lt; &#39;\n&#39; ; }&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;};&lt;/span&gt;&lt;/p&gt;&lt;p&gt;void goodbye(const string&amp;amp; str) {cout &amp;lt;&amp;lt; str &amp;lt;&amp;lt; &#39;\n&#39;; }&lt;/p&gt;&lt;p&gt;int main()&lt;br&gt;{&lt;br&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;Object obj;&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;&lt;b&gt;auto f1 = std::bind(&amp;amp;Object::hello, &amp;amp;obj, &quot;Hi&quot;);&lt;/b&gt;&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;f1();&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;auto f2 = std::bind(goodbye, &quot;Good Bye&quot;);&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt; &lt;/span&gt;f2();&lt;br&gt;}&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="400" y="360" width="440" height="560" as="geometry" />
        </mxCell>
        <mxCell id="1KMhb825qfr1meEJTyxy-8" value="&lt;h1&gt;runExport&lt;/h1&gt;&lt;p&gt;onRequestExport&lt;/p&gt;&lt;p&gt;load(이전에 완료하지 못했던 것들이 있다면 먼저 export 해준다.&lt;/p&gt;&lt;p&gt;두 곳에서 호출 됨.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="40" y="920" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="_PIVCCuhR6tPmFwRGUKL-4" value="&lt;h1&gt;onCompleteExport&lt;/h1&gt;&lt;p&gt;failRequest&lt;/p&gt;&lt;p&gt;addExport&lt;/p&gt;&lt;p&gt;두곳에서 불려옴.&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="40" y="1040" width="240" height="120" as="geometry" />
        </mxCell>
        <mxCell id="_PIVCCuhR6tPmFwRGUKL-5" value="&lt;h1&gt;failRequest&lt;/h1&gt;&lt;p&gt;onRequestExport&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="280" y="1040" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="b7j55R0uiB86d4h7jm7H-1" value="&lt;h1&gt;실행 순서&lt;/h1&gt;&lt;p&gt;main&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;gt; EmApp::createNew&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;gt; EmApp::EmApp&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;gt; EmApp::init&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;gt; EmApp::subscribeMqTopic&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;-&amp;gt; EmApp::onRequestSaveThumbnail&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;-&amp;gt; thumnailAgent_-&amp;gt;addSaveThumbnail(여기가 핵심)&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;-&amp;gt; EmApp::onCompleteThumbnail&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;-&amp;gt; EmApp::onRequestExport&lt;/span&gt;&lt;/p&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;-&amp;gt; EmApp::runExport&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;-&amp;gt;exportAgent_-&amp;gt;addExport(여기가 핵심)&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;-&amp;gt; EmApp:: onCompleteThmbnail&lt;br&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="1200" width="360" height="360" as="geometry" />
        </mxCell>
        <mxCell id="b7j55R0uiB86d4h7jm7H-2" value="main&lt;br&gt;&lt;br&gt;-&amp;gt; EmApp::run&lt;br&gt;&lt;br&gt;-&amp;gt; EmApp::load&lt;br&gt;&lt;br&gt;-&amp;gt; EmApp::runExport&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;-&amp;gt;addExport" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="400" y="1240" width="160" height="140" as="geometry" />
        </mxCell>
        <mxCell id="b7j55R0uiB86d4h7jm7H-3" value="&lt;h1&gt;ExportAgent&amp;nbsp;&lt;/h1&gt;&lt;p&gt;&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;&lt;/p&gt;&lt;p&gt;addExport&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;gt; enqueueJob -&amp;gt; doWork&lt;/span&gt;&lt;/p&gt;&lt;h1&gt;ExportJob&lt;/h1&gt;&lt;p&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;doWork&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="560" y="1200" width="200" height="360" as="geometry" />
        </mxCell>
        <mxCell id="b7j55R0uiB86d4h7jm7H-4" value="&lt;h1&gt;ThumbnailAgent&lt;/h1&gt;&lt;p&gt;addSavseThumbnail -&amp;gt; enquequeJob -&amp;gt; doWork&lt;/p&gt;&lt;h1&gt;ThumbnailJob&lt;/h1&gt;&lt;p&gt;doWork -&amp;gt;&amp;nbsp;&amp;nbsp;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="760" y="1200" width="200" height="360" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
